<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>REGISTER LIFF</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>REGISTER LIFF</h1>
    <img id="pictureUrl" height="50" width="50"/>
    <form action="https://sheetdb.io/api/v1/e45liy93tsrrf" method="post" id="sheetdb-form"  >
      <div class="container">
        <h1>Sign Up</h1>
        <p>Please fill in this form to create an account.</p>
        <hr>
    
        <label for="email"><b>Email</b></label>
        <input type="text" placeholder="Enter Email" name="data[email]" required>
    
        <label for="psw"><b>Password</b></label>
        <input type="password" placeholder="Enter Password" name="data[psw]" required>
    
        <label for="psw repeat"><b>Repeat Password</b></label>
        <input type="password" placeholder="Repeat Password" name="data[psw repeat]" required>
    
        <label>
          <input type="checkbox" checked="checked" name="remember" style="margin-bottom:15px"> Remember me
        </label>
    
        <p>By creating an account you agree to our <a href="#" style="color:dodgerblue">Terms & Privacy</a>.</p>
    
        <div class="clearfix">
          <button type="button" class="cancelbtn">Cancel</button>
          <button type="submit" class="signupbtn">Sign Up</button>
        </div>
      </div>
    </form>




















    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const pictureUrl = document.getElementById("pictureUrl");
      function logOut() {
        liff.logout();
        window.location.reload();
      }
      function logIn() {
        liff.login({ redirectUri: window.location.href });
      }
      async function getUserProfile() {
        const profile = await liff.getProfile();
        axios.get("https://sheetdb.io/api/v1/3awnhw9icpyqx").then((res) => {
          const dataform = res.data;
          if (profile.userId != dataform.userId) {
            axios
              .post("https://sheetdb.io/api/v1/3awnhw9icpyqx", {
                userId: profile.userId,
                displayName: profile.displayName,
                pictureUrl: profile.pictureUrl,
                statusMessage: profile.statusMessage,
              })
              .then((result) => {
                console.log(result);
              })
              .catch((err) => {
                console.error(err);
              });
          } else {
            console.log("It's not frist time");
          }
        });

        pictureUrl.style.display = "block";
        pictureUrl.src = profile.pictureUrl;
      }
      async function main() {
        await liff.init({ liffId: "1657099044-yKDkw7xX" });
        if (liff.isInClient()) {
          getUserProfile();
        } else {
          if (liff.isLoggedIn()) {
            getUserProfile();
            document.getElementById("btnLogOut").style.display = "block";
          } else {
            // logIn();
          }
        }
      }
      main();
    </script>
  </body>
</html>
